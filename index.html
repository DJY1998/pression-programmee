<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Programmiertes Lernen – Druck</title>

  <!-- Für Formeln im LaTeX-ähnlichen Markdown: $p = \frac{F}{A}$ -->
  <script>
    window.MathJax = {
      tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
      svg: { fontCache: 'global' }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" async></script>

  <style>
    :root {
      --bg: #050810;
      --bg-card: #0f172a;
      --accent: #22d3ee;
      --accent-soft: rgba(34, 211, 238, 0.18);
      --danger: #f97373;
      --success: #4ade80;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --border: #1f2937;
      --shadow-soft: 0 18px 40px rgba(0, 0, 0, 0.55);
      --radius-xl: 1.25rem;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Helvetica Neue", Arial, sans-serif;
      background: radial-gradient(circle at top, #0f172a 0, #020617 55%, #000 100%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      align-items: stretch;
      justify-content: center;
      padding: 24px;
    }

    .app {
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(260px, 1.4fr);
      gap: 24px;
      max-width: 1200px;
      width: 100%;
    }

    @media (max-width: 900px) {
      .app {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: radial-gradient(circle at top left, #111827 0, #020617 60%);
      border-radius: var(--radius-xl);
      border: 1px solid var(--border);
      box-shadow: var(--shadow-soft);
      padding: 22px 24px 20px;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background: radial-gradient(circle at top left,
        rgba(34, 211, 238, 0.06),
        transparent 55%);
      opacity: 0.9;
      pointer-events: none;
      z-index: -1;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 14px;
      gap: 12px;
    }

    .title-main {
      font-size: 1.35rem;
      font-weight: 650;
      letter-spacing: 0.03em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .pill {
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      border: 1px solid rgba(148, 163, 184, 0.35);
      color: var(--muted);
      background: rgba(15, 23, 42, 0.85);
    }

    .subtitle {
      font-size: 0.9rem;
      color: var(--muted);
      margin-bottom: 14px;
      line-height: 1.5;
    }

    .objectifs {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 12px;
    }

    .objectif-chip {
      font-size: 0.7rem;
      border-radius: 999px;
      padding: 4px 9px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.9);
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .objectif-chip span {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
    }

    .progress-wrapper {
      margin-bottom: 16px;
    }

    .progress-label-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      font-size: 0.75rem;
      color: var(--muted);
      margin-bottom: 4px;
    }

    .progress-bar-bg {
      height: 6px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      overflow: hidden;
      border: 1px solid rgba(30, 64, 175, 0.9);
    }

    .progress-bar-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--accent), #4ade80);
      transition: width 0.35s ease-out;
    }

    .steps-container {
      margin-top: 8px;
      min-height: 260px;
    }

    .step {
      display: none;
      animation: fadeIn 0.35s ease-out;
    }

    .step.active {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(4px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .step-tag {
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--muted);
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .step-tag::before {
      content: "";
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: radial-gradient(circle, var(--accent) 0, transparent 70%);
      border: 1px solid rgba(34, 211, 238, 0.4);
    }

    .step-title {
      font-size: 1.05rem;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .step-instruction {
      font-size: 0.9rem;
      color: var(--muted);
      margin-bottom: 12px;
      line-height: 1.5;
    }

    .reading-box {
      border-radius: 0.9rem;
      border: 1px dashed rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.65);
      padding: 10px 12px;
      font-size: 0.82rem;
      color: var(--muted);
      margin-bottom: 12px;
    }

    .reading-box strong {
      color: var(--text);
    }

    .formula-box {
      border-radius: 0.9rem;
      border: 1px solid rgba(56, 189, 248, 0.5);
      background: radial-gradient(circle at top left,
        rgba(56, 189, 248, 0.16),
        rgba(15, 23, 42, 0.9));
      padding: 10px 12px;
      font-size: 0.88rem;
      margin-bottom: 12px;
    }

    .formula-box .label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--muted);
      margin-bottom: 4px;
    }

    .formula-box .math {
      font-size: 0.96rem;
      margin-bottom: 4px;
    }

    .formula-box .explain {
      font-size: 0.82rem;
      color: var(--muted);
    }

    .reading-guard {
      border-radius: 0.9rem;
      border: 1px solid rgba(56, 189, 248, 0.5);
      background: rgba(34, 211, 238, 0.08);
      padding: 10px 12px;
      margin: 10px 0;
      font-size: 0.85rem;
      color: var(--muted);
    }

    .reading-guard.done {
      border-color: rgba(74, 222, 128, 0.6);
      background: rgba(34, 197, 94, 0.08);
      color: var(--text);
    }

    .reading-guard button {
      margin-top: 8px;
    }

    .lockable {
      position: relative;
      transition: opacity 0.2s ease;
    }

    .lockable.locked {
      opacity: 0.55;
      pointer-events: none;
    }

    .lockable.locked::after {
      content: "Lies zuerst den angegebenen Abschnitt und bestätige die Lektüre, um die Fragen freizuschalten.";
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 12px;
      text-align: center;
      background: rgba(0, 0, 0, 0.45);
      color: var(--text);
      font-size: 0.82rem;
      border-radius: 0.8rem;
    }

    .question {
      margin-top: 6px;
      margin-bottom: 10px;
      font-size: 0.9rem;
      font-weight: 500;
    }

    .options {
      display: grid;
      gap: 6px;
      margin-bottom: 8px;
    }

    .option-btn {
      width: 100%;
      text-align: left;
      border-radius: 0.8rem;
      border: 1px solid rgba(31, 41, 55, 0.9);
      background: rgba(15, 23, 42, 0.9);
      padding: 8px 10px;
      font-size: 0.88rem;
      color: var(--text);
      cursor: pointer;
      transition: all 0.16s ease-out;
    }

    .option-btn:hover {
      border-color: rgba(56, 189, 248, 0.85);
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.3);
      transform: translateY(-1px);
    }

    .option-btn.correct {
      border-color: rgba(74, 222, 128, 0.9);
      background: rgba(22, 163, 74, 0.18);
    }

    .option-btn.incorrect {
      border-color: rgba(248, 113, 113, 0.9);
      background: rgba(127, 29, 29, 0.2);
    }

    .feedback {
      font-size: 0.82rem;
      margin-bottom: 8px;
      min-height: 18px;
    }

    .feedback.ok {
      color: var(--success);
    }

    .feedback.ko {
      color: var(--danger);
    }

    .numeric-input-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }

    .numeric-input-row input {
      flex: 0 0 130px;
      padding: 6px 8px;
      border-radius: 0.7rem;
      border: 1px solid rgba(31, 41, 55, 0.9);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text);
      font-size: 0.86rem;
      outline: none;
    }

    .numeric-input-row input:focus {
      border-color: rgba(56, 189, 248, 0.9);
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.3);
    }

    .btn-primary, .btn-secondary {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      border-radius: 999px;
      padding: 7px 14px;
      font-size: 0.82rem;
      cursor: pointer;
      border: none;
      outline: none;
      transition: all 0.16s ease-out;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(120deg, var(--accent), #4ade80);
      color: #0b1120;
      font-weight: 600;
    }

    .btn-primary:hover {
      filter: brightness(1.04);
      transform: translateY(-1px);
      box-shadow: 0 12px 25px rgba(34, 211, 238, 0.35);
    }

    .btn-secondary {
      background: rgba(15, 23, 42, 0.95);
      color: var(--muted);
      border: 1px solid rgba(55, 65, 81, 0.9);
    }

    .btn-secondary:hover {
      border-color: rgba(148, 163, 184, 0.9);
      color: var(--text);
    }

    .actions-row {
      margin-top: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .actions-left, .actions-right {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .hint {
      font-size: 0.75rem;
      color: var(--muted);
    }

    /* Seitenpanel */
    .side-card-title {
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .side-section {
      margin-bottom: 14px;
      font-size: 0.8rem;
      color: var(--muted);
    }

    .side-list {
      list-style: none;
      padding-left: 0;
      margin: 6px 0;
    }

    .side-list li {
      padding: 3px 0;
      display: flex;
      align-items: flex-start;
      gap: 6px;
    }

    .side-list li::before {
      content: "•";
      color: var(--accent);
      margin-top: 1px;
    }

    .badge-small {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 999px;
      padding: 2px 7px;
      font-size: 0.7rem;
      border: 1px solid rgba(148, 163, 184, 0.5);
      margin-left: 4px;
      color: var(--muted);
    }

    .side-note {
      border-radius: 0.9rem;
      border: 1px dashed rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.8);
      padding: 8px 9px;
      font-size: 0.78rem;
      margin-top: 6px;
    }

    .score-box {
      border-radius: 0.9rem;
      border: 1px solid rgba(56, 189, 248, 0.55);
      background: var(--accent-soft);
      padding: 8px 9px;
      font-size: 0.8rem;
      margin-bottom: 10px;
    }

    .score-value {
      font-size: 1.4rem;
      font-weight: 600;
      color: var(--accent);
    }

    .score-label {
      font-size: 0.75rem;
      color: var(--muted);
    }

    /* Reward image */
    #reward-badge {
      position: fixed;
      bottom: 18px;
      right: 18px;
      width: 150px;
      height: 150px;
      border-radius: 1rem;
      border: 1px solid rgba(56, 189, 248, 0.45);
      background: rgba(15, 23, 42, 0.92);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      opacity: 0;
      transform: translateY(16px);
      transition: all 0.25s ease-out;
      pointer-events: none;
      z-index: 30;
    }

    #reward-badge.visible {
      opacity: 1;
      transform: translateY(0);
    }

    #reward-badge img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- Hauptspalte: programmierte Sequenz -->
    <main class="card">
      <div class="header">
        <div>
          <div class="title-main">Druck – Geführter Parcours</div>
          <p class="subtitle">
            Arbeite in deinem Tempo. Lies die Hinweise, schlage im Skript nach
            und beantworte die Fragen. Bei einer richtigen Antwort geht es weiter;
            bei einem Fehler gibt es eine kurze Hilfe, bevor du fortfährst.
          </p>
        </div>
        <div class="pill">Programmiertes Lernen</div>
      </div>

      <div class="objectifs">
        <div class="objectif-chip">
          <span></span> Druck als $p = \dfrac{F}{A}$
        </div>
        <div class="objectif-chip">
          <span></span> Einheiten: Pa, bar, mmHg
        </div>
        <div class="objectif-chip">
          <span></span> Hydrostatik $p = p_0 + \rho g h$
        </div>
        <div class="objectif-chip">
          <span></span> Einfache Anwendungen (Wasser, Hg)
        </div>
      </div>

      <div class="progress-wrapper">
      <div class="progress-label-row">
        <div>Fortschritt</div>
        <div id="progress-text">0 / 8 Schritte bestätigt</div>
      </div>
        <div class="progress-bar-bg">
          <div class="progress-bar-fill" id="progress-bar"></div>
        </div>
      </div>

      <div class="steps-container">
        <!-- Schritt 0: Intro -->
        <section class="step active" id="step-intro" data-index="0">
          <div class="step-tag">Startpunkt</div>
          <h2 class="step-title">Wie funktioniert dieser Parcours?</h2>
          <p class="step-instruction">
            Du kommst vielleicht aus einer langen Arbeitsphase – hier sollst du ruhig und selbständig arbeiten können.
            Du kannst jederzeit zurückspringen.
          </p>
          <div class="reading-box">
            <strong>Benötigtes Material</strong><br />
            • Dein Skript <em>« Temperatur – Wärme »</em>, Abschnitte <strong>Druck</strong> und
            <strong>Druck in einer ruhenden Flüssigkeit</strong> (Teil zum Torricelli-Barometer).<br />
            • Dein Taschenrechner.<br />
            • Etwas zum Notieren (Schmierblatt).
          </div>
          <p class="step-instruction">
            Du gehst in kleinen Schritten vor. Nach jeder Antwort bekommst du sofort Rückmeldung.
            Bei einem Fehler gibt es einen kurzen Hilfeschritt (verzweigtes programmiertes Lernen).
          </p>
          <div class="actions-row">
            <div class="actions-left">
              <button class="btn-primary" onclick="goToStep('step-pretest')">
                Parcours starten
              </button>
            </div>
            <div class="actions-right">
              <span class="hint">Zwischen zwei Schritten kannst du jederzeit pausieren.</span>
            </div>
          </div>
        </section>

        <!-- Schritt 1: Diagnose -->
        <section class="step" id="step-pretest" data-index="1">
          <div class="step-tag">Schritt 1 · Diagnose</div>
          <h2 class="step-title">Druck oder Kraft?</h2>
          <div class="reading-box">
            Öffne dein Skript, Abschnitt <strong>« Druck »</strong> (Definition) und lies den ersten Absatz,
            der $p = \dfrac{F}{A}$ erläutert. Notiere die Formel auf deinem Schmierblatt und
            bestätige die Lektüre unten.
          </div>
          <div class="reading-guard" data-step-guard="step-pretest">
            <div>Hast du den Abschnitt « Druck » gelesen, bevor du antwortest?</div>
            <button class="btn-primary" onclick="unlockStep('step-pretest')">
              Abschnitt gelesen → Frage freischalten
            </button>
          </div>

          <div class="lockable" data-step-lock="step-pretest">
            <p class="question">
              Ein Block von $100\,\text{N}$ liegt auf<br />
              (A) einem Tisch mit Fläche $1{,}0\,\text{m}^2$<br />
              (B) demselben Tisch, aber auf einer Platte mit $0{,}10\,\text{m}^2$.<br /><br />
              In welchem Fall ist der <strong>Druck</strong> auf den Tisch größer?
            </p>
            <div class="options">
              <button class="option-btn" data-correct="false" onclick="handleMCQ(this, 'pretest', false)">
                In Fall (A), weil die Kraft gleich bleibt.
              </button>
              <button class="option-btn" data-correct="true" onclick="handleMCQ(this, 'pretest', true)">
                In Fall (B), weil die gleiche Kraft auf eine kleinere Fläche wirkt.
              </button>
              <button class="option-btn" data-correct="false" onclick="handleMCQ(this, 'pretest', false)">
                Der Druck ist in (A) und (B) identisch.
              </button>
            </div>
            <div id="feedback-pretest" class="feedback"></div>
          </div>

          <div class="actions-row">
            <div class="actions-left">
              <button class="btn-secondary" onclick="goToStep('step-intro')">← Zurück</button>
            </div>
            <div class="actions-right">
              <span class="hint">
                Bei einem Fehler folgt eine kurze Erklärung, bevor es weitergeht.
              </span>
            </div>
          </div>
        </section>

        <!-- Schritt 1b: Remedial Druck -->
        <section class="step" id="step-remediation-pression" data-index="1">
          <div class="step-tag">Schritt 1 bis · Gezielte Hilfe</div>
          <h2 class="step-title">Definition von Druck wiederholen</h2>
          <div class="reading-box">
            <strong>Im Skript nachlesen</strong><br />
            1. Finde den Abschnitt <strong>« Druck »</strong> (S. 8) und lies den ersten Absatz, der den Druck als Verhältnis von Kraft und Fläche beschreibt (Beispiel Ballon / Reifen).<br />
            2. Notiere auf deinem Schmierblatt die Definition auf Deutsch:<br />
            <em>« Druck ist die senkrechte Kraft pro Flächeneinheit. »</em>
          </div>
          <div class="formula-box">
            <div class="label">Merkformel (selbst aufschreiben)</div>
            <div class="math">
              $p = \dfrac{F}{A}$
            </div>
            <div class="explain">
              $p$ in Pascal (Pa), $F$ in Newton (N), $A$ in m$^2$.
            </div>
          </div>
          <p class="step-instruction">
            Denk noch einmal an den Tisch: Wenn die Fläche $A$ kleiner wird, die Kraft $F$ aber gleich bleibt – was passiert mit dem Quotienten $F/A$?
          </p>
          <div class="actions-row">
            <div class="actions-left">
              <button class="btn-primary" onclick="goToStep('step-pretest')">
                Diagnosefrage erneut lösen
              </button>
            </div>
            <div class="actions-right">
              <span class="hint">Bei richtiger Antwort geht es weiter.</span>
        </div>
      </div>
    </section>

        <!-- Schritt 1c: Remedial Einheiten -->
        <section class="step" id="step-remediation-unites" data-index="2">
          <div class="step-tag">Schritt 2 bis · Gezielte Hilfe</div>
          <h2 class="step-title">Druckeinheiten wiederholen</h2>
          <div class="reading-box">
            <strong>Zu behalten</strong><br />
            $1\,\text{bar} = 1{,}0 \times 10^5\,\text{Pa}$<br />
            $1\,\text{atm} \approx 1{,}013 \times 10^5\,\text{Pa}$<br />
            $760\,\text{mmHg} \approx 1\,\text{atm} \approx 1{,}0\,\text{bar}$<br />
            $1\,\text{mmHg} \approx 133{,}3\,\text{Pa}$
          </div>
          <p class="step-instruction">
            Rechne zum Vergleichen immer in Pascal oder bar um. Beispiel: $1{,}0\,\text{bar} = 100{\,}000\,\text{Pa}$.
          </p>
          <div class="actions-row">
            <div class="actions-left">
              <button class="btn-primary" onclick="goToStep('step-unites')">Frage erneut lösen</button>
            </div>
          </div>
        </section>

        <!-- Schritt 2: Einheiten -->
        <section class="step" id="step-unites" data-index="2">
          <div class="step-tag">Schritt 2 · Druckeinheiten</div>
          <h2 class="step-title">Pascal, bar und mmHg</h2>
          <div class="reading-box">
            <strong>Geführte Lektüre</strong><br />
            Lies im Skript den Teil, in dem die Druckeinheiten eingeführt werden
            (<strong>« Definition » und Tabelle der Einheiten</strong>, Abschnitt <em>Druck</em>). Notiere auf deinem Schmierblatt:
            <br />• $1\,\text{Pa} = 1\,\text{N}/\text{m}^2$<br />
            • $1\,\text{bar} = 10^5\,\text{Pa}$<br />
            • $1\,\text{mmHg} \approx 133{,}3\,\text{Pa}$ (Quecksilbersäule).
          </div>

          <div class="reading-guard" data-step-guard="step-unites">
            <div>Lies diese Zeilen im Skript (Definition + Einheitentabelle) und bestätige, um die Fragen freizuschalten.</div>
            <button class="btn-primary" onclick="unlockStep('step-unites')">
              Abschnitt gelesen → Fragen freischalten
            </button>
          </div>

          <div class="lockable" data-step-lock="step-unites">
            <p class="question">
              1. Der atmosphärische Druck beträgt etwa $1{,}0\,\text{bar}$. Welche Angabe in Pascal passt am besten?
            </p>
            <div class="options">
              <button class="option-btn" onclick="handleMCQ(this, 'unites1', false)">
                $1{,}0\,\text{Pa}$
              </button>
              <button class="option-btn" onclick="handleMCQ(this, 'unites1', true)">
                $1{,}0 \times 10^5\,\text{Pa}$
              </button>
              <button class="option-btn" onclick="handleMCQ(this, 'unites1', false)">
                $1{,}0 \times 10^3\,\text{Pa}$
              </button>
            </div>

            <p class="question">
              2. Auf einem Barometer liest du $760\,\text{mmHg}$. Wozu entspricht das am ehesten?
            </p>
            <div class="options">
              <button class="option-btn" onclick="handleMCQ(this, 'unites2', true)">
                Etwa dem normalen atmosphärischen Druck.
              </button>
              <button class="option-btn" onclick="handleMCQ(this, 'unites2', false)">
                Beinahe einem perfekten Vakuum.
              </button>
              <button class="option-btn" onclick="handleMCQ(this, 'unites2', false)">
                $760\,\text{Pa}$, also viel weniger als $1\,\text{bar}$.
              </button>
            </div>

            <div id="feedback-unites" class="feedback"></div>
          </div>

          <div class="actions-row">
            <div class="actions-left">
              <button class="btn-secondary" onclick="goToStep('step-pretest')">← Vorheriger Schritt</button>
            </div>
            <div class="actions-right">
              <button class="btn-primary" onclick="goToStep('step-hydrostatique')">
                Nächster Schritt: Druck in einer Flüssigkeit →
              </button>
            </div>
          </div>
        </section>

        <!-- Schritt 3: p = p0 + rho g h -->
        <section class="step" id="step-hydrostatique" data-index="3">
          <div class="step-tag">Schritt 3 · Hydrostatik</div>
          <h2 class="step-title">Woher kommt $p = p_0 + \rho g h$?</h2>

          <div class="reading-box">
            <strong>In Ruhe lesen</strong><br />
            1. Lies im Skript den Abschnitt
            <strong>« Druck in einer ruhenden Flüssigkeit »</strong> (Flüssigkeitssäule mit Dichte
            $\rho$, Höhe $h$ und Querschnitt $S$).<br />
            2. Zeichne in dein Heft die Säule (oben Druck $p_0$, unten Druck $p$). Beschrifte alle Kräfte auf die Säule.
          </div>

          <div class="formula-box">
            <div class="label">Herleitung (Kurzfassung)</div>
            <div class="math">
              Gewicht der Säule: $F = mg = \rho V g = \rho S h g$<br />
              Druck der Säule: $p_{\text{Säule}} = \dfrac{F}{S} = \rho g h$<br />
              Gesamtdruck unten: $p = p_0 + \rho g h$
            </div>
            <div class="explain">
              $p_0$: Druck an der Oberfläche (oft Atmosphärendruck), $h$: Tiefe unter der Oberfläche.
            </div>
          </div>

          <div class="reading-guard" data-step-guard="step-hydrostatique">
            <div>Bestätige, dass du « Druck in einer ruhenden Flüssigkeit » gelesen und die Skizze übernommen hast.</div>
            <button class="btn-primary" onclick="unlockStep('step-hydrostatique')">
              Gelesen / skizziert → freischalten
            </button>
          </div>

          <div class="lockable" data-step-lock="step-hydrostatique">
            <p class="question">
              Wir sind in einem Süßwassersee ($\rho \approx 1000\,\text{kg/m}^3$). Wir tauchen auf $h = 5{,}0\,\text{m}$
              unter die Oberfläche. Die Gesamtdrucktiefe ist näher bei … (die kleine Differenz zwischen $1{,}013$ und $1{,}0$ vernachlässigen).
            </p>

            <div class="options">
              <button class="option-btn" onclick="handleMCQ(this, 'hydro1', false)">
                $p \approx 5{,}0 \times 10^4\,\text{Pa}$ (nur die Wassersäule zählt).
              </button>
              <button class="option-btn" onclick="handleMCQ(this, 'hydro1', true)">
                $p \approx 1{,}5 \times 10^5\,\text{Pa}$ (Atmosphäre + Wasser).
              </button>
              <button class="option-btn" onclick="handleMCQ(this, 'hydro1', false)">
                $p \approx 1{,}0 \times 10^5\,\text{Pa}$ (gleich wie an der Oberfläche).
              </button>
            </div>

            <div id="feedback-hydro" class="feedback"></div>
          </div>

          <div class="actions-row">
            <div class="actions-left">
              <button class="btn-secondary" onclick="goToStep('step-unites')">← Vorheriger Schritt</button>
            </div>
            <div class="actions-right">
              <button class="btn-primary" onclick="goToStep('step-torricelli')">
                Nächster Schritt: Quecksilbersäule →
              </button>
            </div>
          </div>
        </section>

        <!-- Schritt 3b: Remedial Hydro -->
        <section class="step" id="step-remediation-hydro" data-index="3">
          <div class="step-tag">Schritt 3 bis · Gezielte Hilfe</div>
          <h2 class="step-title">p0 und die Flüssigkeitssäule addieren</h2>
          <div class="reading-box">
            <strong>Erinnerung</strong><br />
            $p = p_0 + \rho g h$<br />
            $p_0$: Druck an der Oberfläche (oft $1{,}0\,\text{bar}$).<br />
            $\rho g h$: Zusatzdruck durch die Säule (in Pa).
          </div>
          <p class="step-instruction">
            Berechne immer zuerst $\rho g h$ und addiere dann $p_0$. Für Wasser: $1000 \times 9{,}81 \times h$ ergibt Pascal.
          </p>
          <div class="actions-row">
            <div class="actions-left">
              <button class="btn-primary" onclick="goToStep('step-hydrostatique')">Frage erneut lösen</button>
            </div>
          </div>
        </section>

        <!-- Schritt 4: Torricelli -->
        <section class="step" id="step-torricelli" data-index="4">
          <div class="step-tag">Schritt 4 · Quecksilbersäule</div>
          <h2 class="step-title">Torricelli und die $\text{mmHg}$</h2>

          <div class="reading-box">
            <strong>Gezielte Lektüre</strong><br />
            Suche im Skript den Absatz über das <strong>Torricelli-Barometer</strong> (Quecksilberrohr, das in ein Gefäß getaucht wird). Achte auf:
            <br />
            • die Höhe $h$ der Quecksilbersäule,<br />
            • das Vakuum über dem Quecksilber,<br />
            • den Atmosphärendruck auf das Gefäß.
          </div>

          <p class="step-instruction">
            Wir nehmen die Dichte des Quecksilbers als<br />
            $\rho_{\text{Hg}} = 13{,}6 \times 10^3\,\text{kg/m}^3$ und $g = 9{,}81\,\text{m/s}^2$.
          </p>

          <div class="reading-guard" data-step-guard="step-torricelli">
            <div>Lies den Absatz zum Torricelli-Barometer und sieh dir die Skizze an, bevor du rechnest.</div>
            <button class="btn-primary" onclick="unlockStep('step-torricelli')">
              Gelesen / betrachtet → Rechnung freischalten
            </button>
          </div>

          <div class="lockable" data-step-lock="step-torricelli">
            <p class="question">
              Nutze $p = \rho g h$, um die Quecksilberhöhe zu finden, die zu
              $p_0 = 1{,}01 \times 10^5\,\text{Pa}$ gehört. Gib deine Antwort in mm an.<br /><br />
              (Tipp: Stelle $h$ frei und rechne aus.)
            </p>

            <div class="numeric-input-row">
              <input type="number" id="input-hg" placeholder="Höhe in mm" />
              <button class="btn-primary" onclick="checkNumeric('hg', 760, 40)">
                Prüfen
              </button>
            </div>
            <div id="feedback-hg" class="feedback"></div>
          </div>

          <div class="actions-row">
            <div class="actions-left">
              <button class="btn-secondary" onclick="goToStep('step-hydrostatique')">← Vorheriger Schritt</button>
            </div>
            <div class="actions-right">
              <button class="btn-primary" onclick="goToStep('step-exo-hydro')">
                Nächster Schritt: Übungsaufgaben →
              </button>
            </div>
          </div>
        </section>

        <!-- Schritt 4b: Remedial Hg -->
        <section class="step" id="step-remediation-hg" data-index="4">
          <div class="step-tag">Schritt 4 bis · Gezielte Hilfe</div>
          <h2 class="step-title">Quecksilberhöhe und Druck</h2>
          <div class="reading-box">
            <strong>Formel</strong><br />
            $p = \rho g h \quad \Rightarrow \quad h = \dfrac{p}{\rho g}$<br />
            Für $p \approx 1{,}0 \times 10^5\,\text{Pa}$, $\rho_{\text{Hg}} = 13{,}6 \times 10^3\,\text{kg/m}^3$, $g = 9{,}81$:
            $h \approx 0{,}76\,\text{m} = 760\,\text{mm}$.
          </div>
          <p class="step-instruction">
            Wenn dein Ergebnis weit von 760 mm abweicht, prüfe die Einheiten (m ↔ mm) und die Zehnerpotenzen.
          </p>
          <div class="actions-row">
            <div class="actions-left">
              <button class="btn-primary" onclick="goToStep('step-torricelli')">Frage erneut lösen</button>
            </div>
          </div>
        </section>

        <!-- Schritt 5: einfache Hydro-Übungen -->
        <section class="step" id="step-exo-hydro" data-index="5">
          <div class="step-tag">Schritt 5 · Anwendungen</div>
          <h2 class="step-title">Kleine Hydrostatik-Übungen</h2>

          <p class="step-instruction">
            Für jede Frage: Skizze machen, Formel $p = p_0 + \rho g h$ und Daten aufschreiben, dann rechnen. Du darfst vernünftig runden.
          </p>

          <div class="reading-guard" data-step-guard="step-exo-hydro">
            <div>Lies im Skript die Beispielrechnungen zu $p = p_0 + \rho g h$, bevor du diese zwei Aufgaben machst.</div>
            <button class="btn-primary" onclick="unlockStep('step-exo-hydro')">
              Beispiele gelesen → Aufgaben freischalten
            </button>
          </div>

          <div class="lockable" data-step-lock="step-exo-hydro">
            <p class="question">
              1. In welcher Tiefe unter der Wasseroberfläche erreicht der Gesamtdruck etwa
              $3{,}0\,\text{bar}$ (mit $p_0 \approx 1{,}0\,\text{bar}$)?<br />
              Gib deine Antwort in Metern (grobe Abschätzung).
            </p>

            <div class="numeric-input-row">
              <input type="number" id="input-3bar" placeholder="Tiefe in m" />
              <button class="btn-primary" onclick="checkNumeric('3bar', 20, 5)">
                Prüfen
              </button>
            </div>

            <p class="question">
              2. Ein Wasser-Manometer soll den Atmosphärendruck als entsprechende Wasserhöhe für $1{,}0\,\text{atm}$ anzeigen. Wie hoch müsste die Wassersäule ungefähr sein (in m)?
            </p>

            <div class="numeric-input-row">
              <input type="number" id="input-watercol" placeholder="Höhe in m" />
              <button class="btn-primary" onclick="checkNumeric('watercol', 10, 2)">
                Prüfen
              </button>
            </div>

            <div id="feedback-exos" class="feedback"></div>
          </div>

          <div class="actions-row">
            <div class="actions-left">
              <button class="btn-secondary" onclick="goToStep('step-torricelli')">← Vorheriger Schritt</button>
            </div>
        <div class="actions-right">
          <button class="btn-primary" onclick="goToStep('step-exo-avance')">
            Nächster Schritt: Anwendungssituationen →
          </button>
        </div>
      </div>
    </section>
    <!-- Schritt 5b: Remedial Übungen -->
    <section class="step" id="step-remediation-exo" data-index="5">
      <div class="step-tag">Schritt 5 bis · Gezielte Hilfe</div>
      <h2 class="step-title">p = p0 + ρgh für Wasser wiederholen</h2>
      <div class="reading-box">
        <strong>Größenordnungen</strong><br />
        In Wasser: $\rho \approx 1000\,\text{kg/m}^3$, also $ \rho g h \approx 10^4 \times h$ in Pa.<br />
        $2{,}0\,\text{bar}$ zusätzlich ≈ $2 \times 10^5\,\text{Pa}$ ⇒ Tiefe ≈ $20\,\text{m}$.
      </div>
      <p class="step-instruction">
        Berechne zuerst die Überdruckkomponente ($p - p_0$) und teile dann durch $\rho g$, um $h$ zu finden.
      </p>
      <div class="actions-row">
        <div class="actions-left">
          <button class="btn-primary" onclick="goToStep('step-exo-hydro')">Übungen erneut lösen</button>
        </div>
      </div>
    </section>

    <!-- Schritt 6: Fortgeschrittene Anwendungen -->
    <section class="step" id="step-exo-avance" data-index="6">
        <div class="step-tag">Schritt 6 · Anwendungssituationen</div>
        <h2 class="step-title">Prüfe dein Können</h2>

        <p class="step-instruction">
          Zwei Situationen, die Einheiten und Hydrostatik kombinieren. Verwende $p = p_0 + \rho g h$
          mit $g \approx 9{,}81\,\text{m/s}^2$ und, wenn nicht anders angegeben, $p_0 \approx 1{,}0\,\text{bar}$.
        </p>

        <div class="reading-guard" data-step-guard="step-exo-avance">
          <div>Lies vorher die Bezugswerte für Einheiten (bar ↔ Pa ↔ mmHg) und die Formel $p = p_0 + \rho g h$ im Skript.</div>
          <button class="btn-primary" onclick="unlockStep('step-exo-avance')">
            Bezugswerte gelesen → Aufgaben freischalten
          </button>
        </div>

        <div class="lockable" data-step-lock="step-exo-avance">
          <p class="question">
            1. Beim Tauchen (Meerwasser, $\rho \approx 1025\,\text{kg/m}^3$) in $18{,}0\,\text{m}$ Tiefe – wie groß ist der Gesamtdruck in bar ungefähr?
          </p>
          <div class="numeric-input-row">
            <input type="number" id="input-deepbar" step="0.1" placeholder="Druck in bar" />
            <button class="btn-primary" onclick="checkNumeric('deepbar', 2.8, 0.3)">
              Prüfen
            </button>
          </div>

          <p class="question">
            2. In einem Süßwasserbecken ($\rho \approx 1000\,\text{kg/m}^3$) beträgt der Gesamtdruck bei $12{,}0\,\text{m}$ Tiefe ungefähr wie viel in mmHg?
          </p>
          <div class="numeric-input-row">
            <input type="number" id="input-mmhgdepth" step="10" placeholder="Druck in mmHg" />
            <button class="btn-primary" onclick="checkNumeric('mmhgdepth', 1630, 150)">
              Prüfen
            </button>
          </div>

          <div id="feedback-avance" class="feedback"></div>
        </div>

        <div class="actions-row">
          <div class="actions-left">
            <button class="btn-secondary" onclick="goToStep('step-exo-hydro')">← Vorheriger Schritt</button>
          </div>
        <div class="actions-right">
          <button class="btn-primary" onclick="goToStep('step-final')">
            Nächster Schritt: Abschluss →
          </button>
        </div>
      </div>
    </section>

    <!-- Schritt 6b: Remedial Fortgeschritten -->
    <section class="step" id="step-remediation-avance" data-index="6">
      <div class="step-tag">Schritt 6 bis · Gezielte Hilfe</div>
      <h2 class="step-title">Einheiten und Tiefen vergleichen</h2>
      <div class="reading-box">
        <strong>Nützliche Anhaltspunkte</strong><br />
        Meerwasser: $\rho \approx 1025\,\text{kg/m}^3$ → $ \rho g h \approx 1{,}0 \times 10^4 h$ Pa.<br />
        1 bar ≈ $10^5$ Pa, 1 bar ≈ 760 mmHg. Bei 10 m Wasser kommen etwa 1 bar dazu.
      </div>
      <p class="step-instruction">
        Rechne zuerst in bar oder Pa, addiere $p_0$, und wandle bei Bedarf in mmHg um
        ($p\,\text{[Pa]} / 133{,}3$ ergibt mmHg).
      </p>
      <div class="actions-row">
        <div class="actions-left">
          <button class="btn-primary" onclick="goToStep('step-exo-avance')">Fortgeschrittene Übungen erneut lösen</button>
        </div>
      </div>
    </section>

    <!-- Schritt 7: Abschluss -->
        <section class="step" id="step-final" data-index="7">
          <div class="step-tag">Schritt 7 · Abschluss</div>
          <h2 class="step-title">Wo stehst du?</h2>

          <p class="step-instruction">
            Bevor du das Skript weglegst: Prüfe kurz, ob du die folgenden Punkte <strong>ohne nachzuschlagen</strong> kannst:
          </p>

          <ul class="side-list" style="margin-top: 6px; margin-bottom: 8px;">
            <li>Den Unterschied zwischen Kraft und Druck mit einem Beispiel erklären (Schuhe / Ski).</li>
            <li>Druck von bar in Pascal umrechnen und umgekehrt.</li>
            <li>Erklären, wofür « $1\,\text{mmHg}$ » physikalisch steht.</li>
            <li>Die Formel $p = p_0 + \rho g h$ schreiben und erläutern.</li>
            <li>Den Druck in einer bestimmten Wassertiefe berechnen.</li>
          </ul>

          <div class="reading-box">
            <strong>Letzter Schritt</strong><br />
            Mache jetzt die zugehörigen Übungen im <em>Arbeitsheft</em> (Skript) und notiere deine Antworten. <br />
            Wenn du fertig bist, bestätige unten, damit dein Parcours als abgeschlossen gezählt wird (8/8).
          </div>

          <p class="step-instruction">
            Wenn etwas nicht sitzt, geh zum entsprechenden Schritt zurück (Einheiten, Druck im Flüssigkeit, Quecksilbersäule) und wiederhole die Fragen. Das ist das Prinzip des programmierten Lernens: kleine Schritte mit sofortigem Feedback.
          </p>

          <div class="actions-row">
            <div class="actions-left">
              <button class="btn-primary" onclick="completeFinalStep()">
                Arbeitsheft-Aufgaben erledigt → Schritt bestätigen
              </button>
            </div>
            <div class="actions-right">
              <button class="btn-secondary" onclick="goToStep('step-exo-avance')">← Zurück zu den Übungen</button>
            </div>
          </div>
          <div class="hint" id="final-confirm-hint" style="margin-top: 6px;">
            Wenn alles passt: Du hast die Sequenz abgeschlossen.
          </div>
        </section>
      </div>
    </main>

    <!-- Seitenleiste: Memo / Hilfe -->
    <aside class="card">
      <div class="side-section">
        <div class="side-card-title">Wesentliche Formeln</div>
        <div class="formula-box" style="margin-bottom: 10px;">
          <div class="math">$p = \dfrac{F}{A}$</div>
          <div class="explain">Druck als Kraft pro Fläche.</div>
        </div>
        <div class="formula-box" style="margin-bottom: 10px;">
          <div class="math">$p = p_0 + \rho g h$</div>
          <div class="explain">Gesamtdruck in einer Flüssigkeit in Tiefe $h$.</div>
        </div>
        <div class="formula-box">
          <div class="math">
            $1\,\text{bar} = 10^5\,\text{Pa}$<br />
            $1\,\text{mmHg} \approx 133{,}3\,\text{Pa}$<br />
            $1\,\text{atm} \approx 1{,}013 \times 10^5\,\text{Pa} \approx 760\,\text{mmHg}$
          </div>
        </div>
      </div>

      <div class="side-section">
        <div class="side-card-title">Arbeitsstrategie</div>
        <ul class="side-list">
          <li>Lies immer den angegebenen Absatz im Skript <em>bevor</em> du antwortest.</li>
          <li>Notiere Formeln und Einheiten auf deinem Schmierblatt.</li>
          <li>Bei einem Fehler: Rückmeldung lesen und ggf. einen Schritt zurückgehen.</li>
        </ul>
        <div class="side-note">
          Dieses Panel kannst du als kleines Memo während der ganzen Sequenz nutzen.
        </div>
      </div>

      <div class="side-section">
        <div class="side-card-title">Fortschritt</div>
        <div class="score-box">
          <div class="score-value" id="score-display">0 / 8</div>
          <div class="score-label">
            Bestätigte Schritte (mindestens einmal richtig geantwortet).
          </div>
        </div>
        <p class="side-note">
          Diese Zahl ist keine Note, sondern zeigt dir nur, was du bereits gefestigt hast.
        </p>
      </div>
    </aside>
  </div>

  <div id="reward-badge" aria-live="polite" aria-label="Belohnungsbild">
    <img id="reward-img" src="" alt="Niedliches Tier zur Ermutigung" />
  </div>

  <script>
    const STORAGE_KEY = "pressionProgress_v1";
    const stepsOrder = [
      "step-intro",
      "step-pretest",
      "step-unites",
      "step-hydrostatique",
      "step-torricelli",
      "step-exo-hydro",
      "step-exo-avance",
      "step-final"
    ];

    const stepsNeedingReading = new Set([
      "step-pretest",
      "step-unites",
      "step-hydrostatique",
      "step-torricelli",
      "step-exo-hydro",
      "step-exo-avance"
    ]);

    const mcqStepMap = {
      pretest: "step-pretest",
      unites1: "step-unites",
      unites2: "step-unites",
      hydro1: "step-hydrostatique"
    };

    const rewardImages = [
      "images/image1.avif",
      "images/image2.jpg",
      "images/image3.jpg",
      "images/image4.avif",
      "images/image5.jpg",
      "images/image6.jpg",
      "images/image7.webp"
    ];

    let rewardTimeout = null;
    let validatedSteps = new Set(["step-intro"]);
    let readingUnlocked = {};
    let currentStepId = "step-intro";

    function showReward() {
      const badge = document.getElementById("reward-badge");
      const img = document.getElementById("reward-img");
      if (!badge || !img || rewardImages.length === 0) return;
      const pick = rewardImages[Math.floor(Math.random() * rewardImages.length)];
      img.src = pick;
      badge.classList.add("visible");
      if (rewardTimeout) {
        clearTimeout(rewardTimeout);
      }
      rewardTimeout = setTimeout(() => {
        badge.classList.remove("visible");
      }, 1800);
    }

    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return;
        const parsed = JSON.parse(raw);
        if (Array.isArray(parsed.validatedSteps)) {
          const filtered = parsed.validatedSteps.filter((id) =>
            stepsOrder.includes(id)
          );
          validatedSteps = new Set(filtered);
        }
        readingUnlocked = parsed.readingUnlocked || {};
        currentStepId = parsed.currentStepId || currentStepId;
      } catch (e) {
        console.warn("Fortschritt konnte nicht geladen werden, wir starten neu.");
      }
    }

    function persistState() {
      try {
        const payload = {
          validatedSteps: Array.from(validatedSteps),
          readingUnlocked,
          currentStepId
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
      } catch (e) {
        console.warn("Fortschritt konnte nicht gespeichert werden.", e);
      }
    }

    function isStepUnlocked(stepId) {
      return !stepsNeedingReading.has(stepId) || !!readingUnlocked[stepId];
    }

    function applyLockStates() {
      document.querySelectorAll("[data-step-lock]").forEach((el) => {
        const stepId = el.getAttribute("data-step-lock");
        const unlocked = isStepUnlocked(stepId);
        el.classList.toggle("locked", !unlocked);
      });

      document.querySelectorAll(".reading-guard").forEach((guard) => {
        const stepId = guard.getAttribute("data-step-guard");
        const unlocked = isStepUnlocked(stepId);
        guard.classList.toggle("done", unlocked);
        const btn = guard.querySelector("button");
        if (btn) {
          btn.disabled = unlocked;
          btn.textContent = unlocked
            ? "Lektüre bestätigt"
            : btn.getAttribute("data-default-label") ||
              btn.textContent ||
              "Lektüre bestätigen";
        }
      });
    }

    function unlockStep(stepId) {
      readingUnlocked[stepId] = true;
      applyLockStates();
      persistState();
    }

    function updateProgress(save = true) {
      const total = stepsOrder.length;
      const done = validatedSteps.size;
      const percent = (done / total) * 100;

      document.getElementById("progress-bar").style.width = percent + "%";
      document.getElementById("progress-text").textContent =
        done + " / " + total + " Schritte bestätigt";
      document.getElementById("score-display").textContent =
        done + " / " + total;
      if (save) {
        persistState();
      }
    }

    function goToStep(id, options = {}) {
      document.querySelectorAll(".step").forEach((s) => s.classList.remove("active"));
      let finalId = id;
      const target = document.getElementById(id);
      if (!target) {
        finalId = "step-intro";
      }
      const targetElement = document.getElementById(finalId);
      if (targetElement) {
        targetElement.classList.add("active");
      }
      // Finale automatisch validieren
      if (finalId === "step-final") {
        validatedSteps.add("step-final");
      }
      currentStepId = finalId;
      applyLockStates();
      updateProgress(!options.skipSave);
    }

    function handleMCQ(button, group, isCorrect) {
      const stepId = mcqStepMap[group];
      const feedbackId =
        group === "pretest" ? "feedback-pretest"
        : group === "unites1" || group === "unites2" ? "feedback-unites"
        : group === "hydro1" ? "feedback-hydro"
        : "";

      if (stepId && !isStepUnlocked(stepId)) {
        if (feedbackId) {
          const fbLocked = document.getElementById(feedbackId);
          if (fbLocked) {
            fbLocked.textContent =
              "Bitte zuerst die angegebene Stelle lesen und die Lektüre bestätigen.";
            fbLocked.classList.add("ko");
            fbLocked.classList.remove("ok");
          }
        }
        return;
      }

      const container = button.parentElement;

      if (container) {
        container.querySelectorAll(".option-btn").forEach((btn) => {
          btn.classList.remove("correct", "incorrect");
        });
      }

      if (isCorrect) {
        button.classList.add("correct");
        if (feedbackId) {
          const fb = document.getElementById(feedbackId);
          fb.textContent = "✔ Richtig, du kannst zum nächsten Schritt gehen.";
          fb.classList.add("ok");
          fb.classList.remove("ko");
        }

        if (group === "pretest") {
          validatedSteps.add("step-pretest");
          goToStep("step-unites");
        } else if (group === "unites1" || group === "unites2") {
          validatedSteps.add("step-unites");
        } else if (group === "hydro1") {
          validatedSteps.add("step-hydrostatique");
        }
        showReward();
      } else {
        button.classList.add("incorrect");
        if (feedbackId) {
          const fb = document.getElementById(feedbackId);
          fb.classList.remove("ok");
          fb.classList.add("ko");
          if (group === "pretest") {
            fb.textContent =
              "✖ Noch nicht ganz. Druck hängt von der Fläche ab. Du gehst gleich zu einer kurzen Erklärung.";
            setTimeout(() => goToStep("step-remediation-pression"), 900);
          } else if (group === "unites1" || group === "unites2") {
            fb.textContent =
              "✖ Prüfe im Skript die Umrechnungen zwischen bar, Pa und mmHg.";
            setTimeout(() => goToStep("step-remediation-unites"), 900);
          } else if (group === "hydro1") {
            fb.textContent =
              "✖ Achtung: Gesamtdruck = Atmosphärendruck + Druck der Wassersäule.";
            setTimeout(() => goToStep("step-remediation-hydro"), 900);
          }
        }
      }
      updateProgress();
    }

    function checkNumeric(kind, expected, tolerance) {
      let inputId, feedbackId, stepId, remediationId;
      if (kind === "hg") {
        inputId = "input-hg";
        feedbackId = "feedback-hg";
        stepId = "step-torricelli";
        remediationId = "step-remediation-hg";
      } else if (kind === "3bar") {
        inputId = "input-3bar";
        feedbackId = "feedback-exos";
        stepId = "step-exo-hydro";
        remediationId = "step-remediation-exo";
      } else if (kind === "watercol") {
        inputId = "input-watercol";
        feedbackId = "feedback-exos";
        stepId = "step-exo-hydro";
        remediationId = "step-remediation-exo";
      } else if (kind === "deepbar") {
        inputId = "input-deepbar";
        feedbackId = "feedback-avance";
        stepId = "step-exo-avance";
        remediationId = "step-remediation-avance";
      } else if (kind === "mmhgdepth") {
        inputId = "input-mmhgdepth";
        feedbackId = "feedback-avance";
        stepId = "step-exo-avance";
        remediationId = "step-remediation-avance";
      }

      if (!isStepUnlocked(stepId)) {
        const fbLocked = document.getElementById(feedbackId);
        if (fbLocked) {
          fbLocked.textContent =
            "Bitte zuerst die angegebene Lektüre bestätigen, um diese Aufgaben freizuschalten.";
          fbLocked.classList.add("ko");
          fbLocked.classList.remove("ok");
        }
        return;
      }

      const value = parseFloat(document.getElementById(inputId).value);
      const fb = document.getElementById(feedbackId);
      if (isNaN(value)) {
        fb.textContent = "Gib bitte eine Zahl ein.";
        fb.classList.add("ko");
        fb.classList.remove("ok");
        return;
      }

      const diff = Math.abs(value - expected);
      if (diff <= tolerance) {
        fb.textContent = "✔ Plausibles Ergebnis (Toleranz ±" + tolerance + ").";
        fb.classList.add("ok");
        fb.classList.remove("ko");
        validatedSteps.add(stepId);
        showReward();
      } else {
        fb.textContent =
          "✖ Ergebnis weit entfernt. Gehe von der Formel aus und prüfe deine Einheiten.";
        fb.classList.add("ko");
        fb.classList.remove("ok");
        if (remediationId) {
          setTimeout(() => goToStep(remediationId), 900);
        }
      }
      updateProgress();
    }

    function completeFinalStep() {
      validatedSteps.add("step-final");
      const hint = document.getElementById("final-confirm-hint");
      if (hint) {
        hint.textContent = "✔ Schritt bestätigt – du hast 8/8 erreicht.";
      }
      showReward();
      updateProgress();
    }

    function initializeApp() {
      loadState();
      validatedSteps.add("step-intro");
      if (!document.getElementById(currentStepId)) {
        currentStepId = "step-intro";
      }
      document.querySelectorAll(".step").forEach((s) => s.classList.remove("active"));
      const start = document.getElementById(currentStepId) ? currentStepId : "step-intro";
      document.getElementById(start).classList.add("active");
      applyLockStates();
      updateProgress();
    }

    initializeApp();
  </script>
</body>
</html>
